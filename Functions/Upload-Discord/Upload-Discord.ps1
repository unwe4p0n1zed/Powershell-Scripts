#############################################################################################################################################################################
#__________________________________________________________/\\\______________________/\\\\\\\_______________________/\\\______________________________________/\\\__        #
# ________________________________________________________/\\\\\____________________/\\\/////\\\_________________/\\\\\\\_____________________________________\/\\\__       #
#  ______________________________________________________/\\\/\\\______/\\\\\\\\\___/\\\____\//\\\_______________\/////\\\_____________________________________\/\\\__      #
#   __/\\\____/\\\__/\\/\\\\\\____/\\____/\\___/\\______/\\\/\/\\\_____/\\\/////\\\_\/\\\_____\/\\\__/\\/\\\\\\_______\/\\\__/\\\\\\\\\\\_____/\\\\\\\\_________\/\\\__     #
#    _\/\\\___\/\\\_\/\\\////\\\__\/\\\__/\\\\_/\\\____/\\\/__\/\\\____\/\\\\\\\\\\__\/\\\_____\/\\\_\/\\\////\\\______\/\\\_\///////\\\/____/\\\/////\\\___/\\\\\\\\\__    #
#     _\/\\\___\/\\\_\/\\\__\//\\\_\//\\\/\\\\\/\\\___/\\\\\\\\\\\\\\\\_\/\\\//////___\/\\\_____\/\\\_\/\\\__\//\\\_____\/\\\______/\\\/_____/\\\\\\\\\\\___/\\\////\\\__   #
#      _\/\\\___\/\\\_\/\\\___\/\\\__\//\\\\\/\\\\\___\///////////\\\//__\/\\\_________\//\\\____/\\\__\/\\\___\/\\\_____\/\\\____/\\\/______\//\\///////___\/\\\__\/\\\__  #
#       _\//\\\\\\\\\__\/\\\___\/\\\___\//\\\\//\\\______________\/\\\____\/\\\__________\///\\\\\\\/___\/\\\___\/\\\_____\/\\\__/\\\\\\\\\\\__\//\\\\\\\\\\_\//\\\\\\\/\\_ #
#        __\/////////___\///____\///_____\///__\///_______________\///_____\///_____________\///////_____\///____\///______\///__\///////////____\//////////___\///////\//__#
#                                                                                                                                                                           #
#  github.com/unwe4p0n1zed                                                tiktok.com/@unwe4p0n1zed                                                                          #
#  twitter.com/unwe4p0n1zed                                               youtube.com/@unwe4p0n1zed                                                                         #
#                                                                                                                                                                           #
#  Title: Upload-Discord                                                                                                                                                    #
#  Description: This PowerShell code can upload either a file or text to the specified Discord channel using the provided webhook URL.                                      #
#___________________________________________________________________________________________________________________________________________________________________________#
#                                             __  __________  _      ______________ __  ________   ___  __________  ____     __                                             #
#                                            / / / / __/ __/ | | /| / /  _/_  __/ // / / ___/ _ | / _ \/ __/ __/ / / / /    / /                                             #
#                                           / /_/ _\ \/ _/   | |/ |/ _/ /  / / / _  / / /__/ __ |/ , _/ _// _// /_/ / /__  /_/                                              #
#                                           \____/___/___/   |__/|__/___/ /_/ /_//_/  \___/_/ |_/_/|_/___/_/  \____/____/ (_)                                               #
#############################################################################################################################################################################

function Upload-Discord {
    param(
        [CmdletBinding()]
        [Parameter(Mandatory = $false)]
        [Alias("f")]
        [string]$filePath,
        
        [Parameter(Mandatory = $false)]
        [Alias("t")]
        [string]$text,

        [Parameter(Mandatory = $true)]
        [Alias("u")]
        [string]$hookUrl,

        [Parameter(Mandatory = $false)]
        [Alias("i")]
        [bool]$includeBaseDirectory = $false
    )
    
    $Body = @{
        'username' = $env:username
        'content'  = $text
    }

    # Validate that either $text or $filePath is provided
    if (([string]::IsNullOrEmpty($text)) -and ([string]::IsNullOrEmpty($filePath))) {
        Write-Error "Provide either text or filepath or both to upload to discord."
        return
    }
    
    # Send text if provided
    if (-not ([string]::IsNullOrEmpty($text))) {
        Invoke-RestMethod -ContentType 'Application/Json' -Uri $hookurl  -Method Post -Body ($Body | ConvertTo-Json)
    }

    # Send file if provided
    if (-not ([string]::IsNullOrEmpty($filePath))) {
        # Include base user directory
        if ($IncludeBaseDirectory) {
            $UserDir = Get-Variable HOME -valueOnly
            $filePath = Join-Path $UserDir $filePath
        }
        curl.exe -F "file1=@$filePath" $hookurl
    }
}